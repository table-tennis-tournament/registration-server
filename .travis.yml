language: java
jdk:
- openjdk8
services:
- docker
env:
  global:
  - secure: QAMi7kb71Df5NvcQtDau/jlHSRZyK53rCPIc45DAOM5fxV09ausJFxEIPVPdWlAObdaBoJLzwFowmbdQ6G/yb7KaA69W1HfQnp2TINY1JomebOoH8YzQO6arxSpLc2MstjWGAfhXse/nZzUFjhvwAemZa3v+c0w8fIVbeIAAmx5jHesuYassPjroEVBNW3GBZ7kOBtbSW5ZF5I9mISQxuoFcBwzn+1LN631RQH7k4tyRQ5xKrZdctIFPSPJgtfUrWzwJsfeOUd1q4DpMdUg0hxwtna5M97gnThGa9NP0jRvZlDsbQdSQwJD/xUhyOMMcNLmNBedFnfetzaI4s4cybSU9AFTYrhCaVoj718t8PHoOZy1vV2jxTM7qyz4XMqHSAowwtr3spuYscMQ3u+tMASEFP9TKqqXClacAOueclZnh9MBQZFlydpEEvpkpeq7n2wlNqhT7LB07S6BfKR6StmjzNjGd3/vENw0Cd0lqQBZWASm/hBZBYD33FuegRI7WlBqRtykE9VKKe7qgFFGc17oHT/6yOIkzrt6CQcKnLBpMXEoUUqp790tOeOFTvR9ROMX9xT7XxOxiDprs6xIjePKmL3rp2I1c99SHl5YrmK8UZfJ6h+p/lxC21Xr2TGZ9jFCZUptrTRRHiDSwz837Q+xwu7yiIjzb9dsKbpCg4AM=
  - secure: IX0unZHddyd/hbuMUW51cRgzLHm2bsUehuxJamu9nsIvUYFFFlSDFKGJQpyEGllZwo0y8itSS9CXgu9gSGoBAPzsDfGZB9N5gPxAgC6tiCcFpT3vScRi1J1Ng5olJu61oagjMf2/MEGZPkyIvXXa+dobazbP1MIZ+19q0i38sXLtaxOeqPbhNQ/wIhb8UZt2dbKPUfaRY85/3VmvDusfz3zdiVVxX9sxyuQ69jH2RserjaczK7fy62UcOuLgY9jMOOJBMDhntpYb/+BTqM/MbJAHyGrE41R0ndnzKrpV1jSU0AA6QTkR6Wdd59SxJcz76pMCoT8Ah0049A42QI+WL2dH7s7cZqtHo+4f5/r47wFWu+lHtq81altx31/azmAAX3o7tsXgWopdzBNvN9lFQ4AqjAtuREMQesPdr0rY+TFZKk1rtUc4RC74m+Zm0M7EJh+vPHFZRLXt/oBAitI2VCGdo10hy9izyREeRAyY59He7jN9qL3EjCfFG122dqfsfunEmOn0iiMXSUy/QKra7y8t7kHnWqr+aOQG1xsE9IIn3blLzVj9j22qTG9WGiOIJGOH9yIMpYPmHZjTchPEP5d1OFcDoYyB4Wlb54eKTRGZ/5Z1qTOgvy70l8Kj3XFoy0FCRzB7sNso7rKqNdVN5J3mPSO522IzzuNUEbJ0yZY=
  - secure: uWbZJGExWqljO726szJ9BtZlH2tNQT7M46Z/pOME+Dk0UvLNcHwekLkX0Mg/I69lFxaoX4kT3+vo4Pp48aeXIU/lH6V1t67Kq1E8BWfj1AhSQyJJ+AesbjqGtRZYRu2vzPfOsJaxNButGH29Y+5anOlDYA7Ebz8vMEnFmvn5Syyi4ohQFoJI9BRhmLDDtb7PuN1YTAImQgU6CqvCZ/8us0/n9QLl1gJvX9EHxRScaAfSx+OeFx/d/jFu3dJulwcEhATjuzghWxQm3qW0a3DJjJrn/0AoDhFrUhpYJpGXPGrxqQlpi5ErTpEDR1TCl7bRQra/xVjPJUbY7LsF1fHyJEV0Fl4f+p0nrPxVYDXM+k2X+PLxbLleBKprf2mdSVGzfzZ0jB+lLtS+89n8OY6JY5kETJ4xxJY/nmLk+E2xRcIAb/i2yOHzxg0jlM2pkwgUHgDyOL+UcRQDqvmBfuFp+DCkEp3dP3bweZ6YTyvLY1ehDJOmjbA9MoN0pyjI+pG73VwHJictdwSAuGpEu7zR+5ak2KqJHpPlNpYhKE+/f8JnGiMVvsybWax4yszi2Il6rlGuNinlMmhWOX9SMwH4ZKS9o9sVf/09cwTM6KiRtUAoSBfUCrDfzQWDyT9Y1FkxsTutTuL1LCAScX9TiWR6/HDHu6thXicYNP+OojxvO9E=
  - COMMIT=${TRAVIS_COMMIT::7}
before_install:
- docker pull bitnami/tomcat:8.0
script:
- mvn clean install -B
after_success:
- export COMMIT=${TRAVIS_COMMIT::7}
- export TAG=`if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$TRAVIS_BRANCH-$COMMIT";
  fi`
- docker login -u $DOCKER_USER -p $DOCKER_PASSWORD
- docker build . -t $IMAGE_NAME:latest
- docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME:latest
- docker push $IMAGE_NAME:$TAG
- export TITLE="$IMAGE_NAME:$TAG is built properly and pushed to Dockerhub"
- export TIMESTAMP=`date`
- export GIT_LOG=`git log -1 --pretty=%B $COMMIT`
- export TEXT="[build version] $TAG<br />[datetime] $TIMESTAMP<br />[changelog] $GIT_LOG<br
  />"
cache:
  directories:
  - "$HOME/.m2/repository"
